<link rel="import" href="chromedash-color-status.html">

<polymer-element name="chromedash-feature" extends="li" attributes="feature open needsflag">
<template>
<link rel="stylesheet" type="text/css" href="../css/elements/chromedash-feature.css">
<div on-click="toggleOpen">
  <div class="topcorner pull-right">
    <span hidden?="{{feature.impl_status_chrome != 'Deprecated'}}" class="tooltip" title="{{feature.impl_status_chrome}}"><i class="icon-remove-sign" data-tooltip-part></i></span>
    <span hidden?="{{!needsflag}}" class="tooltip" title="Experimental feature behind a flag."><i class="icon-beaker" data-tooltip-part></i></span>
    <content select=".edit"></content>
  </div>
  <hgroup>
    <chromedash-color-status class="tooltip" title="Compatiblity Risk: overall interest from browser vendors and web developers" value="{{overallViews}}" max="7" corner></chromedash-color-status>
    <h2>{{feature.name}}</h2>
    <label class="category" on-click="categoryFilter">{{feature.category}}</label>
  </hgroup>
  <section class="desc"><summary class="{{open: open}}">{{feature.summary}}</summary></section>
  <template if="{{open}}">
    <section>
      <h3>Implementation Status</h3>
      <div class="impl_status">
        <span><label>{{feature.impl_status_chrome}}</label>{{feature.shipped_milestone}}</span>
        <span><label>Prefixed</label>{{feature.prefixed ? 'Yes' : 'No'}}</span>
        <a href="{{feature.bug_url}}" target="_blank" hidden?="{{!feature.bug_url}}">Launch bug</a>
        <span class="owner" hidden?="{{!feature.owner.length}}">
          <label>Owner(s)</label><template repeat="{{owner in feature.owner}}">
            {{owner}}
          </template>
        </span>
      </div>
    </section>
    <section>
      <h3>Consensus &amp; Standardization</h3>
      <div class="views">
        <span alt="{{feature.ff_views.text}}" title="{{feature.ff_views.text}}">
          <chromedash-color-status value="{{feature.ff_views.value}}" max="7"></chromedash-color-status>
          <template if="{{feature.ff_views_link}}">
            <a href="{{feature.ff_views_link}}" target="_blank">Firefox</a>
          </template>
          <label hidden?="{{feature.ff_views_link}}">Firefox</label>
        </span>
        <span alt="{{feature.ie_views.text}}" title="{{feature.ie_views.text}}">
          <chromedash-color-status value="{{feature.ie_views.value}}" max="7"></chromedash-color-status>
          <template if="{{feature.ie_views_link}}">
            <a href="{{feature.ie_views_link}}" target="_blank">IE</a>
          </template>
          <label hidden?="{{feature.ie_views_link}}">IE</label>
        </span>
        <span alt="{{feature.safari_views.text}}" title="{{feature.safari_views.text}}">
          <chromedash-color-status value="{{feature.safari_views.value}}" max="7"></chromedash-color-status>
          <template if="{{feature.safari_views_link}}">
            <a href="{{feature.safari_views_link}}" target="_blank">Safari</a>
          </template>
          <label hidden?="{{feature.safari_views_link}}">Safari</label>
        </span>
        <span alt="{{feature.web_dev_views.text}}" title="{{feature.web_dev_views.text}}">
          <chromedash-color-status value="{{feature.web_dev_views.value}}" max="7"></chromedash-color-status>
          <label>Web developers</label>
        </span>
      </div>
      <div>
        <template if="{{feature.spec_link}}">
          <a href="{{feature.spec_link}}" target="_blank">{{feature.standardization.text}}</a>
        </template>
        <span hidden?="{{feature.spec_link}}">{{feature.standardization.text}}</span>
        <a href="http://caniuse.com/#search={{feature.name}}" target="_blank">Browser share %</a>
      </div>
    </section>
    <template bind if="{{feature.comments}}">
      <section>
        <h3>Comments</h3>
        <summary>{{feature.comments}}</summary>
      </section>
    </template>
  </template>
</div>
</template>
<script>
  Polymer('chromedash-feature', {
    applyAuthorStyles: true,
    overallViews: 0,
    open: false,
    needsflag: false,
    openChanged: function() {
      this.open ? this.classList.add('open') : this.classList.remove('open');
    },
    toggleOpen: function(e, details, sender) {
      // Don't toggle panel if tooltip or link is being clicked.
      if (e.target.classList.contains('tooltip') ||
          'tooltipPart' in e.target.dataset || e.target.tagName == 'A') {
        return;
      }
      this.open = !this.open;
    },
    calculateOverallViews: function() {
      this.overallViews = (this.feature.ff_views.value +
                           this.feature.ie_views.value +
                           this.feature.safari_views.value +
                           this.feature.web_dev_views.value) / 4;
    },
    featureChanged: function() {
      this.calculateOverallViews();
    },
    categoryFilter: function(e, details, sender) {
      e.stopPropagation();
      this.fire('filter-category', {val: sender.textContent});
    }
  });
</script>
</polymer-element>

